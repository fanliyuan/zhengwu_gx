<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>搜索结果页</title>
    <link rel="shortcut icon" href="../img/favicon.png" type="image/x-icon">
    <script src="../assets/jquery.min.js"></script>
    <script src="../assets/pagination.min.js"></script>
    <link rel="stylesheet" href="../assets/reset.css">
    <link rel="stylesheet" href="../assets/pagination.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../css/search.css">
</head>
<body>
    @@include('commons/header.html')
    <div class="layout">
        <div class="search-title">检索结果</div>
        <div id="data-container" class="data-container"></div>
        <div id="pagination-container" class="pagination-container"></div>
    </div>
    <script>
      // 内容模板
      function simpleTemplating(data) {
        var html = '<ul>';
        $.each(data, function (index, item) {
          html += '<li class="row"><h4 class="title"><a href="'
            + (item.href || "javascript:;")
            +'">' 
            + (item.title || '暂无')
            + '</a></h4><p class="content">'
            + (item.content || '暂无')
            + '</p><p class="description">'
            + (item.description || '暂无')
            +'</p></li>';
        });
        html += '</ul>';
        return html;
      }
      // 从地址栏获取搜索关键字
      var keywords = decodeURI(window.location.search.replace('?keywords=', ''))
     $('#pagination-container').pagination({
        dataSource: 'http://127.0.0.1:9090/fakedata1.json?keywords='+keywords,
        locator: 'data',
        totalNumberLocator: function(res) {
          return res.total
        },
        callback: function (data, pagination) {
          // 数据遍历,同时替换关键字,使关键字加上标签,实现关键字变色
          for(var i = 0; i < data.length; i++) {
            data[i].title=data[i].title.replace(new RegExp(keywords, 'g'),'<span class="red">'+keywords+'</span>')
            }
            // 生成html模板字符串
            var html = simpleTemplating(data);
            // 渲染dom
            $('#data-container').html(html);
        },
        pageSize: 10,
        prevText: '上一页',
        nextText: '上一页',
        ellipsisText: '···',
        footer: function(currentPage, totalPage, totalNumber) {
          return '<span class="pagination-footer">每页10条数据,'+'共'+totalPage+'页</span>'
        },
        pageLink: 'javascript:;'
      })
    </script>

    @@include('commons/footer.html')
    <script src="../js/common.js"></script>
</body>
</html>